{% extends "layout.html" %}

{% block body %}
<style>
    /* 1. Style cho th·∫ª s·ªë li·ªáu (Metric Cards) */
    .st-metric-card {
        background: white; border: 1px solid #f0f2f6; border-radius: 12px; padding: 24px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.02); transition: all 0.3s ease;
    }
    .st-metric-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        border-color: #ff4b4b;
    }
    .st-metric-label { font-size: 0.9rem; color: #6c757d; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
    .st-metric-value { font-size: 2.5rem; font-weight: 800; color: #154360; margin-top: 5px; }

    /* 2. Style cho Tabs (Ki·ªÉu Streamlit g·∫°ch ch√¢n) */
    .nav-tabs { border-bottom: 2px solid #e9ecef; gap: 20px; }
    .nav-tabs .nav-link {
        border: none; color: #6c757d; font-weight: 600;
        padding: 15px 5px; font-size: 1.1rem;
        transition: all 0.3s; position: relative;
        background: transparent !important;
    }
    .nav-tabs .nav-link:hover { color: #154360; }
    .nav-tabs .nav-link.active { color: #ff4b4b !important; }
    .nav-tabs .nav-link.active::after {
        content: ''; position: absolute; bottom: -2px; left: 0; width: 100%;
        height: 3px; background-color: #ff4b4b;
        border-radius: 3px 3px 0 0;
    }

    /* 3. Style cho b·∫£ng v√† Badge */
    .table-custom thead th {
        background-color: #f8f9fa; color: #495057; font-weight: 700; border-bottom: 2px solid #dee2e6;
    }
    .badge-import { background-color: #d1e7dd; color: #0f5132; }
    .badge-export { background-color: #f8d7da; color: #842029; }
</style>

<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-dark"><i class="bi bi-grid-1x2-fill text-primary"></i> DASHBOARD V·∫¨N H√ÄNH</h3>
        <span class="badge bg-light text-dark border px-3 py-2">
            Last updated: <span id="time-now">Just now</span>
        </span>
    </div>

    <div class="row mb-5">
        <div class="col-md-4">
            <div class="st-metric-card">
                <div class="st-metric-label"><i class="bi bi-box-seam"></i> T·ªïng T·ªìn Kho (Units)</div>
                <div class="st-metric-value">{{ "{:,}".format(total_stock) }}</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="st-metric-card">
                <div class="st-metric-label"><i class="bi bi-tags"></i> Lo·∫°i SKU ƒêang C√≥</div>
                <div class="st-metric-value">{{ sku_count }}</div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="st-metric-card">
                <div class="st-metric-label"><i class="bi bi-exclamation-circle"></i> L·ªánh SX Pending</div>
                <div class="st-metric-value text-danger">{{ pending_po }}</div>
            </div>
        </div>
    </div>

    <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="log-tab" data-bs-toggle="tab" data-bs-target="#log" type="button">
                üìù Nh·∫≠t K√Ω Kho
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="po-tab" data-bs-toggle="tab" data-bs-target="#po" type="button">
                üè≠ Ti·∫øn ƒê·ªô S·∫£n Xu·∫•t
            </button>
        </li>
    </ul>

    <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="log" role="tabpanel">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-custom mb-0">
                            <thead>
                                <tr>
                                    <th class="ps-4">Th·ªùi gian</th>
                                    <th>M√£ FullCode</th>
                                    <th>H√†nh ƒë·ªông</th>
                                    <th>Qty</th>
                                    <th>User</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in records %}
                                <tr>
                                    <td class="ps-4 text-muted small">{{ row['Timestamp'] }}</td>
                                    <td class="fw-bold text-primary">{{ row['FullCode'] }}</td>
                                    <td>
                                        {% if 'IMPORT' in row['Action'] %}
                                            <span class="badge badge-import rounded-pill">NH·∫¨P KHO</span>
                                        {% else %}
                                            <span class="badge badge-export rounded-pill">XU·∫§T KHO</span>
                                        {% endif %}
                                    </td>
                                    <td class="fw-bold">{{ row['Qty'] }}</td>
                                    <td class="text-muted small"><i class="bi bi-person-circle"></i> {{ row['User'] }}</td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="5" class="text-center py-4 text-muted">Ch∆∞a c√≥ d·ªØ li·ªáu n√†o.</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane fade" id="po" role="tabpanel">
            <div class="card border-0 shadow-sm rounded-4">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-custom align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="ps-4 py-3">M√£ L·ªánh (PO)</th>
                                    <th class="text-center py-3">Ti·∫øn ƒê·ªô</th>
                                    <th class="text-center py-3">Tr·∫°ng Th√°i</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if po_records %}
                                    {% for p in po_records %}
                                    <tr>
                                        <td class="ps-4 fw-bold text-primary">{{ p['PO_ID'] }}</td>

                                        <td style="width: 40%;">
                                            <div class="progress" style="height: 8px; border-radius: 10px;">
                                                <div class="progress-bar
                                                    {{ 'bg-success' if p['Status']=='Done' else 'bg-primary' if p['Status']=='Running' else 'bg-secondary' }}"
                                                    role="progressbar"
                                                    style="width: {{ '100' if p['Status']=='Done' else '50' if p['Status']=='Running' else '5' }}%">
                                                </div>
                                            </div>
                                        </td>

                                        <td class="text-center">
                                            {% if p['Status'] == 'Done' %}
                                                <span class="badge bg-success bg-opacity-10 text-success border border-success px-3 py-2 rounded-pill">
                                                    ‚úÖ Ho√†n Th√†nh
                                                </span>
                                            {% elif p['Status'] == 'Running' %}
                                                <span class="badge bg-primary bg-opacity-10 text-primary border border-primary px-3 py-2 rounded-pill">
                                                    üöÄ ƒêang Ch·∫°y
                                                </span>
                                            {% else %}
                                                <span class="badge bg-warning bg-opacity-10 text-warning border border-warning px-3 py-2 rounded-pill">
                                                    ‚è≥ ƒêang Ch·ªù
                                                </span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="3" class="text-center py-5 text-muted">
                                            <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                                            Ch∆∞a c√≥ l·ªánh s·∫£n xu·∫•t n√†o
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}